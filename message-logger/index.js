(function(l,r,a,d,o,_,g,u){"use strict";const{FormIcon:h,FormSwitchRow:p}=_.Forms;o.storage.nopk??=!1;var v=()=>(u.useProxy(o.storage),React.createElement(a.ReactNative.ScrollView,null,React.createElement(p,{label:"Ignore PluralKit",leading:React.createElement(h,{source:g.getAssetIDByName("ic_block")}),onValueChange:t=>void(o.storage.nopk=t),value:o.storage.nopk})));const n=[],c=r.findByProps("_channelMessages"),i=r.findByProps("updateMessageRecord","createMessageRecord"),E=r.findByName("MessageRecord",!1),f=r.findByName("RowManager");n.push(d.before("dispatch",a.FluxDispatcher,([t])=>{if(t.type==="MESSAGE_DELETE"){if(t.__vml_cleanup)return t;const e=c.get(t.channelId)?.get(t.id);return!e||e.author?.id=="1"||e.state=="SEND_FAILED"?t:(o.storage.nopk&&fetch(`https://api.pluralkit.me/v2/messages/${encodeURIComponent(e.id)}`).then(s=>s.json()).then(s=>{e.id===s.original&&!s.member?.keep_proxy&&a.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",id:e.id,channelId:e.channel_id,__vml_cleanup:!0})}),[{message:{...e.toJS(),__vml_deleted:!0},type:"MESSAGE_UPDATE"}])}})),n.push(d.after("generate",f.prototype,([t],e)=>{t.rowType===1&&t.message.__vml_deleted&&(e.message.edited="deleted",e.backgroundHighlight??={},e.backgroundHighlight.backgroundColor=a.ReactNative.processColor("#da373c22"),e.backgroundHighlight.gutterColor=a.ReactNative.processColor("#da373cff"))})),n.push(d.instead("updateMessageRecord",i,function([t,e],s){return e.__vml_deleted?i.createMessageRecord(e,t.reactions):s.apply(this,[t,e])})),n.push(d.after("createMessageRecord",i,function([t],e){e.__vml_deleted=t.__vml_deleted})),n.push(d.after("default",E,([t],e)=>{e.__vml_deleted=!!t.__vml_deleted}));const m=()=>{n.forEach(t=>t());for(const t in c._channelMessages)for(const e of c._channelMessages[t]._array)e.__vml_deleted&&a.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",id:e.id,channelId:e.channel_id,__vml_cleanup:!0})};return l.onUnload=m,l.settings=v,l})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.components,vendetta.ui.assets,vendetta.storage);
